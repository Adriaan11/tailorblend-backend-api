# MINIMAL TEST DOCKERFILE
# This is a sanity check to verify Railway infrastructure works
# If THIS fails, the problem is infrastructure/config, not our app

FROM python:3.11-slim

WORKDIR /app

# Install only what we need for the test
RUN pip install --no-cache-dir fastapi uvicorn

# Create a minimal inline app that ONLY returns health check
RUN echo 'from fastapi import FastAPI\nimport uvicorn\nimport os\n\napp = FastAPI()\n\n@app.get("/api/health")\ndef health():\n    return {"status": "ok", "test": "minimal"}\n\nif __name__ == "__main__":\n    port = int(os.getenv("PORT", 5000))\n    uvicorn.run(app, host="0.0.0.0", port=port)' > test_app.py

EXPOSE 5000

HEALTHCHECK --interval=15s --timeout=10s --start-period=60s --retries=3 \
    CMD curl -fsS http://127.0.0.1:${PORT:-5000}/api/health || exit 1

CMD ["python", "test_app.py"]
